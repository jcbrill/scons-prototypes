S:\Scratch\jbrill-popen>python -V
Python 3.6.8

S:\Scratch\jbrill-popen>python win_subprocess.py

TEST 1 subprocess.Popen (os=ps, env=cmd):
    COMSPEC:
        os.environ['COMSPEC'] = C:\WINDOWS\System32\WindowsPowerShell\v1.0\powershell.exe
        env['COMSPEC'] = C:\Windows\system32\cmd.exe
    COMMAND:
        "c:\software\msvs-2022-143-com\vc\auxiliary\build\vcvarsall.bat" amd64 & set COMSPEC
    METHOD:
        windows_subprocess_popen
    STDOUT:

    STDERR:

    EXCSTR:
        subprocess error (returncode = 1): At line:1 char:70
        + ... re\msvs-2022-143-com\vc\auxiliary\build\vcvarsall.bat amd64 & set COM ...
        +                                                                 ~
        The ampersand (&) character is not allowed. The & operator is reserved for future use; wrap an ampersand in double quotation marks ("&") to pass it as part of a string.
            + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
            + FullyQualifiedErrorId : AmpersandNotAllowed



TEST 2 subprocess.Popen (os=cmd, env=ps):
    COMSPEC:
        os.environ['COMSPEC'] = C:\Windows\system32\cmd.exe
        env['COMSPEC'] = C:\WINDOWS\System32\WindowsPowerShell\v1.0\powershell.exe
    COMMAND:
        "c:\software\msvs-2022-143-com\vc\auxiliary\build\vcvarsall.bat" amd64 & set COMSPEC
    METHOD:
        windows_subprocess_popen
    STDOUT:
        **********************************************************************
        ** Visual Studio 2022 Developer Command Prompt v17.0
        ** Copyright (c) 2022 Microsoft Corporation
        **********************************************************************
        [vcvarsall.bat] Environment initialized for: 'x64'
        COMSPEC=C:\WINDOWS\System32\WindowsPowerShell\v1.0\powershell.exe

    STDERR:
        vswhere.exe : The term 'vswhere.exe' is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again.
        At line:1 char:1
        + vswhere.exe -property catalog_productSemanticVersion -path c:\Softwar ...
        + ~~~~~~~~~~~
            + CategoryInfo          : ObjectNotFound: (vswhere.exe:String) [], CommandNotFoundException
            + FullyQualifiedErrorId : CommandNotFoundException

        Get-ChildItem : A positional parameter cannot be found that accepts argument '/a-d-h'.
        At line:1 char:1
        + dir c:\Software\MSVS-2022-143-Com\Common7\Tools\vsdevcmd\ext\*.bat /b ...
        + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
            + CategoryInfo          : InvalidArgument: (:) [Get-ChildItem], ParameterBindingException
            + FullyQualifiedErrorId : PositionalParameterNotFound,Microsoft.PowerShell.Commands.GetChildItemCommand


    EXCSTR:


TEST 3 subprocess.Popen (os=ps, env=ps):
    COMSPEC:
        os.environ['COMSPEC'] = C:\WINDOWS\System32\WindowsPowerShell\v1.0\powershell.exe
        env['COMSPEC'] = C:\WINDOWS\System32\WindowsPowerShell\v1.0\powershell.exe
    COMMAND:
        "c:\software\msvs-2022-143-com\vc\auxiliary\build\vcvarsall.bat" amd64 & set COMSPEC
    METHOD:
        windows_subprocess_popen
    STDOUT:

    STDERR:

    EXCSTR:
        subprocess error (returncode = 1): At line:1 char:70
        + ... re\msvs-2022-143-com\vc\auxiliary\build\vcvarsall.bat amd64 & set COM ...
        +                                                                 ~
        The ampersand (&) character is not allowed. The & operator is reserved for future use; wrap an ampersand in double quotation marks ("&") to pass it as part of a string.
            + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
            + FullyQualifiedErrorId : AmpersandNotAllowed



TEST 4 subprocess.Popen (os=cmd, env=cmd):
    COMSPEC:
        os.environ['COMSPEC'] = C:\Windows\system32\cmd.exe
        env['COMSPEC'] = C:\Windows\system32\cmd.exe
    COMMAND:
        "c:\software\msvs-2022-143-com\vc\auxiliary\build\vcvarsall.bat" amd64 & set COMSPEC
    METHOD:
        windows_subprocess_popen
    STDOUT:
        **********************************************************************
        ** Visual Studio 2022 Developer Command Prompt v17.5.4
        ** Copyright (c) 2022 Microsoft Corporation
        **********************************************************************
        [vcvarsall.bat] Environment initialized for: 'x64'
        COMSPEC=C:\Windows\system32\cmd.exe

    STDERR:

    EXCSTR:


S:\Scratch\jbrill-popen>